
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ระบบบันทึกข้อมูลผู้ป่วย - EMS UBON</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      font-family: 'Prompt', sans-serif;
      background: linear-gradient(to bottom, #e53935, #1e88e5);
      color: white;
      padding: 20px;
    }
    h1 {
      font-size: 2.5em;
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-size: 1.2em;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      font-size: 1em;
      border: none;
      border-radius: 10px;
    }
    .section {
      background-color: rgba(255, 255, 255, 0.2);
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 20px;
    }
    button {
      font-size: 1.2em;
      padding: 10px 30px;
      border: none;
      background: #ffffff;
      color: #e53935;
      border-radius: 10px;
      margin-top: 20px;
      cursor: pointer;
    }
    table {
      width: 100%;
      margin-top: 20px;
      background: white;
      color: black;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid gray;
    }
  </style>
</head>
<body>

<h1>🩺 ระบบบันทึกข้อมูลผู้ป่วย <br>EMERGENCY MEDICAL SERVICE UBONRATCHATHANI</h1>

<div class="section">
  <label>📅 วันที่ <input type="date" id="date"></label>
  <label>⏰ เวลา <input type="time" id="time"></label>
  <label>🚑 หน่วยปฏิบัติการ <input type="text" id="unit"></label>
  <label>🧍‍♂️ ชื่อผู้ป่วย <input type="text" id="name"></label>
  <label>❤️ โรคประจำตัว <input type="text" id="disease"></label>
  <label>😷 อาการ <textarea id="symptom"></textarea></label>
  <label>🌡️ T <input id="T" type="text"></label>
  <label>💓 P <input id="P" type="text"></label>
  <label>💓 PR <input id="PR" type="text"></label>
  <label>🩺 BP <input id="BP" type="text"></label>
  <label>🫁 SpO2 <input id="SpO2" type="text"></label>
  <label>🩸 DTX <input id="DTX" type="text"></label>
  <label>🧠 E <input id="E" type="text"></label>
  <label>🗣️ V <input id="V" type="text"></label>
  <label>🤲 M <input id="M" type="text"></label>
  <label>🩹 การดูแล <textarea id="care"></textarea></label>
  <label>📞 ประสานงาน <textarea id="coordination"></textarea></label>
  <label>🛻 รับจาก <input id="from" type="text"></label>
  <label>🏥 นำส่ง <input id="to" type="text"></label>

  <button onclick="submitForm()">💾 บันทึกข้อมูล</button>
  <button onclick="loadData()">📂 เรียกดูข้อมูลจาก Google Sheet</button>
</div>

<div class="section">
  <h2>📋 ข้อมูลล่าสุด</h2>
  <table id="latestData">
    <thead>
      <tr><th>เวลา</th><th>ชื่อ</th><th>หน่วย</th><th>อาการ</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbwN_M1DxJQAyDasTjvgANSlV1bXh1hGN457YThbzpy3J6X1PDjAxbEXP2wNS6crTp6j5Q/exec';

  function submitForm() {
    const formData = {
      date: document.getElementById("date").value,
      time: document.getElementById("time").value,
      unit: document.getElementById("unit").value,
      name: document.getElementById("name").value,
      disease: document.getElementById("disease").value,
      symptom: document.getElementById("symptom").value,
      T: document.getElementById("T").value,
      P: document.getElementById("P").value,
      PR: document.getElementById("PR").value,
      BP: document.getElementById("BP").value,
      SpO2: document.getElementById("SpO2").value,
      DTX: document.getElementById("DTX").value,
      E: document.getElementById("E").value,
      V: document.getElementById("V").value,
      M: document.getElementById("M").value,
      care: document.getElementById("care").value,
      coordination: document.getElementById("coordination").value,
      from: document.getElementById("from").value,
      to: document.getElementById("to").value,
    };

    Swal.fire({ title: 'กำลังบันทึก...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

    fetch(scriptURL, { method: 'POST', body: new URLSearchParams(formData) })
      .then(response => {
        Swal.fire('บันทึกสำเร็จ!', '', 'success');
        localStorage.setItem("lastFormData", JSON.stringify(formData));
      })
      .catch(error => {
        Swal.fire('เกิดข้อผิดพลาด', error.message, 'error');
      });
  }

  function loadData() {
    window.open("https://docs.google.com/spreadsheets/d/xxxxxxxxxxxxxxxxxxxx/edit", "_blank");
  }

  window.onload = () => {
    const last = JSON.parse(localStorage.getItem("lastFormData"));
    if (last) {
      for (let key in last) {
        if (document.getElementById(key)) {
          document.getElementById(key).value = last[key];
        }
      }
    }
  };
</script>

</body>
</html>
